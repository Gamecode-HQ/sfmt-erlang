# List of changes on sfmt-erlang

## Pure Erlang SFMT module

* Pure Erlang SFMT module now added as working code by request (from 0.8.0\_RELEASE)

## Seeding algorithm changed for `seed(integer())` functions

* The old `seed/1` function called `init_gen_rand/1` (up to 0.8.0\_RELEASE)
* The internal state generated by `init_gen_rand/1` is predictable,
  especially when the value of the 1st element of the state list is
  very close to the given seed value. 
  (Michael Gebetsroither discovered this behavior)
* The new `seed/1` function calls `init_by_list32/1` (from 0.8.1\_RELEASE)
  and the seed is given as `[integer()]`,
  to reduce predictability of the 1st element of the state list.

## C NIFs

* MSC/BORLANDC compilation flags removed (from 0.9.1\_RELEASE)
* C NIFs based on SFMT 1.3.3 added (from 0.3.0\_RELEASE)
* The version number of this NIF is 101 (see `NIF_LOAD_INFO` macro value)

## Notable bugfixes

* asn1 application now starts before starting up public\_key application on `support/getrebar` (from 0.9.1\_RELEASE)
* `gen_rand_all/1` is now properly applied in `sfmt_pure` module when `gen_rand32/1` was first invoked (from 0.8.2\_RELEASE)
* Catched up with the latest rebar configuration file (from 0.7.0\_RELEASE)
* Dynamically building ebin/sfmt.app (from 0.7.0\_RELEASE)
* PDIC\_SEED now named differently for each period (bugfix, from 0.5.2\_RELEASE)

## Removed code

* Wichmann-Hill 2006 RNG code is removed
* netpbm test code is removed

## Notes on refactoring

* Speedup by NIF: ~40 times faster than the pure Erlang code
  (when fully inline-optimized (see rebar.config))
* For the pure-Erlang code: writing `++` (append) operators by ring buffer loops
  (as a pair of lists consuming the head elements, and the corresponding accumulators)
  made the code ~50% faster; the pure Erlang code available under `reference_texts/`
* `gen_rand32/1`, `gen_rand32_max/2`, and `gen_rand_float/1` use Erlang lists 
  (Dan Gudmudsson showed the list version is faster)
* SSE2 code and options in sfmt-extstate were removed due to causing crash of Erlang BEAM
  (and even if the SSE2 code was enabled the performance increase would be minimal)
